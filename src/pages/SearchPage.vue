<template>
  <div>
    <h1 class="title">Search Page</h1>
    <b-input-group prepend="Search Query:" id="search-input">
      <b-form-input v-model="searchQuery"></b-form-input>
      
      <b-form-input v-if="positionFlag===true" v-model="position" placeholder="Position Number">
        <b-input-group-append>
          <b-button @click="filterByPosition()" variant="success">Search</b-button>
        </b-input-group-append>
      </b-form-input>

      <!-- <b-form-input v-else-if="searchTeamFlag===true">
        <b-input-group-append>
          <b-button @click="searchTeam()" variant="success">Search</b-button>
        </b-input-group-append>
      </b-form-input>

      <b-form-input v-else>
        <b-input-group-append>
          <b-button @click="simpleSearchPlayer()" variant="success">Search</b-button>
        </b-input-group-append>
      </b-form-input> -->

      <b-input-group-append>
        <b-button @click="searchTeam()" variant="success">Search</b-button>
      </b-input-group-append>

    </b-input-group>

    <br>
    Your search Query: {{searchQuery }}
    <br>
      <input type="checkbox" id="postion" value="position" v-model="checkedNames">
      <label for="jack">Filter By position</label>
      <input type="checkbox" id="team" value="Team" v-model="checkedNames">
      <label for="john">Search Team</label>
      <input type="checkbox" id="mike" value="Mike" v-model="checkedNames">
      <label for="mike">Mike</label>
    <br>

    Checked names: {{checkedNames}}
    <br>
    <span v-for="res in searchResult" :key="res">
          <TeamPreview :propObj="results"></TeamPreview>
    </span>   
    <span v-for="res in searchResult" :key="res">
          <PlayerPreview :propObj="res"></PlayerPreview>
    </span> 

      



  <!-- <h2>Search Results</h2>
    <span v-if( status != 0 ) v-for="res in result.data" :key="res.position">
      <pokemon-preview :position="res.position"></pokemon-preview>
      <PlayerPreview></PlayerPreview> 
   </span> -->

  </div>

  
</template>

<script>

 import  PlayerPreview from "../components/PlayerPreview";
 import TeamPreview from "../components/TeamPreview";
export default {
  components: { PlayerPreview, TeamPreview },
  //   props:{
  //   anObject: Object
  // },
  data() {
    return {
      searchQuery:"",
      checkedNames:[],
      positionFlag: false,
      searchTeamFlag:false,
      position:0,
      teamname:"",
      results: Object,
      status:0
    };
  },
  methods:{

  async simpleSearchPlayer(results){
        try {
          let check= [this.searchQuery,this.position,this.teamname]
          console.log(check);
          const params = {
               name:  this.searchQuery,
            };
          results = await this.axios.get(
          `http://localhost:3000/guest/Search/player/${params.name}`
          );
      } catch (err) {
        console.log("server:"+err.response);
      }
      this.status=results.status
      console.log(this.status);
      console.log(results);
      this.results= results.data
    },

  async filterByPosition(results){
       try {
            let check= [this.searchQuery,this.position,this.teamname]
            console.log(check);
            let params = new URLSearchParams();
            params.append("name",this.searchQuery);
            params.append("position", this.position);
            let req = {
              params: params
            };
            results = await this.axios.get(
          'http://localhost:3000/guest/Search/filter/player/',req);
      } catch (err) {
        console.log("server:"+err);
       
      }
      this.status=results.status
      console.log(this.status);
      console.log(results);
      this.results= results.data
    },

    async searchTeam(results){
        try {
          let check= [this.searchQuery]
          console.log(check);
          const params = {
               name:  this.searchQuery,
            };
          results = await this.axios.get(
          `http://localhost:3000/guest/Search/team/${params.name}`
          );
      } catch (err) {
        console.log("server:"+err.response);
      }
      this.status=results.status
      console.log(this.status);
      console.log(results);
      this.results= results.data
    },


    async startSearch(){
      await this.filterByPosition(this.results);
    },



  },
  computed:{
      searchResult(){
        if(this.status===200){
          return this.results
        }
      else return [];
  }},
  updated() {
    if (this.checkedNames.find( element => element === "position")){
        this.positionFlag=true;
      }
    else this.positionFlag=false;
    }
}
</script>

<style scoped>

#search-input {
  margin-left: 20px; 
  width: 500px; 
}
</style>